<html>
<head>
	<title>Startup Data Visualization - Angela Hu, Val Mack, Rong Wu</title>
	<link rel="stylesheet" href="main.css"/>
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto">
	<script src="https://d3js.org/d3.v4.min.js"></script>
	<script src="http://d3js.org/topojson.v2.min.js"></script>
	<script
  src="https://code.jquery.com/jquery-3.2.1.min.js"
  integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
  crossorigin="anonymous"></script>
</head>
<body>
	<div class="intro">
		<h1>Startups 2017</h1>
		<hr/>
	</div>
	<div class="main">
		<div class="fig3">
			<div class="info">
				<h3>SIZE</h3>
				<h4>The majority of startups have at most 200 employees.</h4>
				<p>Companies listed for each circle have at most <i>n</i> employees, where <i>n</i> is the number that appears when you hover over a circle. The radius of each circle represents the relative difference in company size between groups of companies. The width of each circumference is the relative amount of companies with <i>n</i> employees.</p>
			</div>
			<svg id="fig3"></svg>
		</div>
	</div>
	<script>
		// globals
		var width = "75%";
		var height = "500";
		var backgroundColor = "#f5f5f5";
		
		// scales
		var employeesScale = d3.scaleSqrt().domain([0, 5000]).range([20, 400]);
		var companiesScale = d3.scaleLinear().domain([0, 53]).range([.2, 24]);
		
		/* BEGIN FIGURE 3 */
		
		var f3 = d3.select("#fig3").attr("width", width).attr("height", height).append("g").attr("transform", "translate(80,0)");
		
		var widthFloat = parseFloat(d3.select("#fig3").style("width"));
		var rawData;
		var companiesBySize;
		
		function parse(row) {
			if (row.Employees) {
				var dash = row.Employees.indexOf("-");
				row.Employees = parseFloat(row.Employees.slice(dash+1));
				return row;
			}
		}
		
		// load data
		d3.csv("100companies_employees.csv", parse, function (error, data) {
			if (error) { console.log(error); }
			
			rawData = data;
			
			companiesBySize = d3.nest()
			.key(function (d) { return d.Employees; })
			.entries(rawData);
			
			f3.selectAll("circle")
			.data(companiesBySize)
			.enter()
			.append("circle")
			.attr("cx", widthFloat/2)
			.attr("cy", height/2)
			.attr("fill", backgroundColor)
			.attr("stroke", "steelblue")
			.attr("r", function(d) {
				// employee size
				return employeesScale(d.key);
			})
			.attr("stroke-width", function(d) {
				// number of companies
				return companiesScale(d.values.length);
			})
			.on("mouseover", showData)
			.on("mouseout", hideData);
			
			var labels = f3.append("g")
			.attr("transform", "translate("+widthFloat/2+","+height/2+")");
			
			function showData(d) {
				//companies
				f3.append("text")
				.text(
					function() {
						var companies = [];
						d.values.forEach(function(c){
							companies.push(c.Name);
						});
						companies.forEach(function(i) {
							f3.append("text")
							.text(i)
							.attr("x", "-60")
							.attr("y", companies.indexOf(i)*16)
							.attr("fill", "steelblue")
							.attr("transform", "translate(10,20)");
						})
					});
				//employees
				labels.append("text")
				.text(d.key)
				.style("font-size","14")
				.attr("x", -employeesScale(d.key)+(.1*employeesScale(d.key)))
				.attr("y", "-2")
				.attr("fill", "steelblue");
				//radius
				labels.append("line")
				.style("stroke", "steelblue")
				.attr("x1", -employeesScale(d.key))
				.attr("y1","0")
				.attr("x2", "0")
				.attr("y2", "0");
			}
			
			function hideData(d) {
				f3.selectAll("text").remove();
				labels.selectAll("text").remove();
				labels.selectAll("line").remove();
			}
			
		});
		
		
		
	</script>
</body>
</html>